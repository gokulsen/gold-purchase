<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gold Purchase Tracker</title>
<style>
    /* General Styles */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(to right, #f5f7fa, #c3cfe2);
        margin: 0;
        padding: 20px;
        color: #333;
    }
    h1 {
        text-align: center;
        margin-bottom: 30px;
        color: #d4af37; /* Gold color */
        text-shadow: 1px 1px 2px #999;
    }

    /* Summary Card */
    .summary {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 15px;
        margin-bottom: 30px;
    }
    .card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        padding: 15px 20px;
        flex: 1 1 180px;
        text-align: center;
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    .card span {
        font-weight: bold;
        font-size: 1.3em;
        color: #d4af37;
    }
    .card input {
        width: 90px;
        padding: 5px 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        text-align: center;
    }

    /* Form */
    #addForm {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-bottom: 25px;
    }
    #addForm input, #addForm button {
        padding: 10px 12px;
        font-size: 14px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }
    #addForm button {
        background: #d4af37;
        color: #fff;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: 0.2s;
    }
    #addForm button:hover {
        background: #bfa034;
    }

    /* Table */
    table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        background: #fff;
    }
    th, td {
        padding: 12px 15px;
        text-align: center;
    }
    th {
        background: #d4af37;
        color: #fff;
    }
    tr:nth-child(even) {
        background: #f9f9f9;
    }
    tr:hover {
        background: #fff3cd;
    }

    /* Action buttons */
    .action-btn {
        padding: 5px 10px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        margin: 0 2px;
        transition: 0.2s;
    }
    .edit-btn {
        background: #17a2b8;
        color: #fff;
    }
    .edit-btn:hover {
        background: #138496;
    }
    .delete-btn {
        background: #dc3545;
        color: #fff;
    }
    .delete-btn:hover {
        background: #c82333;
    }
</style>
</head>
<body>

<h1>Gold Purchase Tracker</h1>

<div class="summary">
    <div class="card">Total Gold: <span id="totalGold">0</span> g</div>
    <div class="card">Total Cost: ₹<span id="totalCost">0</span></div>
    <div class="card">Today's Gold Price: ₹<input type="number" id="todayPrice" step="0.01" value="12720"></div>
    <div class="card">Profit/Loss: ₹<span id="profitLoss">0</span></div>
    <div class="card">Profit/Loss %: <span id="profitLossPercent">0</span>%</div>
</div>

<form id="addForm">
    <input type="date" id="purchaseDate" required>
    <input type="number" step="0.01" id="amount" placeholder="Amount ₹" required>
    <input type="number" step="0.001" id="gold" placeholder="Gold g" required>
    <button type="submit">Add Purchase</button>
</form>

<table>
    <thead>
        <tr>
            <th>Purchase Date</th>
            <th>Amount (₹)</th>
            <th>Gold (g)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="purchaseTable"></tbody>
</table>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://febpaanqrqgrnbyrvfxx.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZlYnBhYW5xcnFncm5ieXJ2Znh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NDUzNzMsImV4cCI6MjA3NjUyMTM3M30.dFyrWiNKqGCVDGLN9HU2IyRuI6rqAJaZGwRQjXri3mQ'
const supabase = createClient(supabaseUrl, supabaseKey)

const addForm = document.getElementById('addForm')
const purchaseTable = document.getElementById('purchaseTable')
const totalGoldEl = document.getElementById('totalGold')
const totalCostEl = document.getElementById('totalCost')
const todayPriceInput = document.getElementById('todayPrice')
const profitLossEl = document.getElementById('profitLoss')
const profitLossPercentEl = document.getElementById('profitLossPercent')

let editingId = null

// Load purchases
async function loadPurchases() {
    const { data, error } = await supabase
        .from('gold_purchases')
        .select('*')
        .order('purchase_date', { ascending: true })

    if (error) { console.error(error); return }

    purchaseTable.innerHTML = ''
    data.forEach(p => addRowToTable(p))
    calculateSummary()
}

// Add row with Edit/Delete buttons
function addRowToTable(purchase) {
    const row = document.createElement('tr')
    row.dataset.id = purchase.id
    row.innerHTML = `
        <td>${purchase.purchase_date}</td>
        <td>₹${parseFloat(purchase.amount).toFixed(2)}</td>
        <td>${parseFloat(purchase.gold).toFixed(3)} g</td>
        <td>
            <button class="action-btn edit-btn" onclick="editRow(${purchase.id})">Edit</button>
            <button class="action-btn delete-btn" onclick="deleteRow(${purchase.id})">Delete</button>
        </td>
    `
    purchaseTable.appendChild(row)
}

// Calculate summary
function calculateSummary() {
    let totalGold = 0
    let totalCost = 0
    purchaseTable.querySelectorAll('tr').forEach(row => {
        const amount = parseFloat(row.cells[1].innerText.replace('₹',''))
        const gold = parseFloat(row.cells[2].innerText.replace(' g',''))
        totalGold += gold
        totalCost += amount
    })

    totalGoldEl.innerText = totalGold.toFixed(3)
    totalCostEl.innerText = totalCost.toFixed(2)

    const todayPrice = parseFloat(todayPriceInput.value)
    if (!isNaN(todayPrice)) {
        const profitLoss = (totalGold * todayPrice) - totalCost
        profitLossEl.innerText = profitLoss.toFixed(2)
        const profitPercent = totalCost > 0 ? (profitLoss / totalCost) * 100 : 0
        profitLossPercentEl.innerText = profitPercent.toFixed(2)
        profitLossEl.style.color = profitLoss >= 0 ? 'green' : 'red'
        profitLossPercentEl.style.color = profitLoss >= 0 ? 'green' : 'red'
    } else {
        profitLossEl.innerText = '0'
        profitLossPercentEl.innerText = '0'
    }
}

// Delete row
window.deleteRow = async (id) => {
    if (!confirm('Are you sure you want to delete this purchase?')) return
    const { error } = await supabase.from('gold_purchases').delete().eq('id', id)
    if (error) { alert('Error deleting row'); console.error(error); return }
    loadPurchases()
}

// Edit row
window.editRow = (id) => {
    const row = purchaseTable.querySelector(`tr[data-id='${id}']`)
    if (!row) return
    document.getElementById('purchaseDate').value = row.cells[0].innerText
    document.getElementById('amount').value = parseFloat(row.cells[1].innerText.replace('₹',''))
    document.getElementById('gold').value = parseFloat(row.cells[2].innerText.replace(' g',''))
    editingId = id
    addForm.querySelector('button').innerText = 'Update Purchase'
}

// Add/Update purchase
addForm.addEventListener('submit', async (e) => {
    e.preventDefault()
    const purchaseDate = document.getElementById('purchaseDate').value
    const amount = parseFloat(document.getElementById('amount').value)
    const gold = parseFloat(document.getElementById('gold').value)

    if (editingId) {
        const { error } = await supabase.from('gold_purchases').update({ purchase_date: purchaseDate, amount, gold }).eq('id', editingId)
        if (error) { alert('Error updating'); console.error(error); return }
        editingId = null
        addForm.querySelector('button').innerText = 'Add Purchase'
    } else {
        const { data, error } = await supabase.from('gold_purchases').insert([{ purchase_date: purchaseDate, amount, gold }])
        if (error) { alert('Error adding'); console.error(error); return }
    }

    addForm.reset()
    loadPurchases()
})

// Recalculate when today's price changes
todayPriceInput.addEventListener('input', calculateSummary)

// Initialize
loadPurchases()
</script>
</body>
</html>
